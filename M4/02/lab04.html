
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <title>LAB 4 - Application Insights logging with .NET · HonKit</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 4.0.4">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="lab05.html" />
    
    
    <link rel="prev" href="lab03.html" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">About</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    AZURE JOURNEY
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Develop Azure Compute Solutions</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../M1/01/">
            
                <a href="../../M1/01/">
            
                    
                    1. Implement IaaS solutions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="../../M1/01/Provision_vm.html">
            
                <a href="../../M1/01/Provision_vm.html">
            
                    
                    1.1. Provision virtual machines in Azure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="../../M1/01/Create_arm.html">
            
                <a href="../../M1/01/Create_arm.html">
            
                    
                    1.2. Create and deploy Azure Resource Manager templates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3" data-path="../../M1/01/Manage_container.html">
            
                <a href="../../M1/01/Manage_container.html">
            
                    
                    1.3. Manage container images in Azure Container Registry
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4" data-path="../../M1/01/Run_container.html">
            
                <a href="../../M1/01/Run_container.html">
            
                    
                    1.4 Run container images in Azure Container Instances
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Hands-on LABS</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../M1/01/lab01.html">
            
                <a href="../../M1/01/lab01.html">
            
                    
                    Lab 1 - Create a VM by using the Azure Command-Line Interface (CLI)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../../M1/01/lab02.html">
            
                <a href="../../M1/01/lab02.html">
            
                    
                    Lab 2 - Create a Docker container image and deploy it to Azure Container Registry
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../../M1/01/lab03.html">
            
                <a href="../../M1/01/lab03.html">
            
                    
                    Lab 3 - Deploy an Azure container instance
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../../M1/02/">
            
                <a href="../../M1/02/">
            
                    
                    2. Create Azure App Service Web Apps
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="../../M1/02/Azure_app_service.html">
            
                <a href="../../M1/02/Azure_app_service.html">
            
                    
                    2.1. Explore Azure App Service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="../../M1/02/Config_app_service.html">
            
                <a href="../../M1/02/Config_app_service.html">
            
                    
                    2.2. Configure web app settings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="../../M1/02/Scaling_app_service.html">
            
                <a href="../../M1/02/Scaling_app_service.html">
            
                    
                    2.3. Scale apps in Azure App Service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.4" data-path="../../M1/02/Azure_app_service_deploy.html">
            
                <a href="../../M1/02/Azure_app_service_deploy.html">
            
                    
                    2.4. Explore Azure App Service deployment slots
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Hands-on Labs</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../../M1/02/lab01.html">
            
                <a href="../../M1/02/lab01.html">
            
                    
                    LAB 1 - Build a backend API by using Azure Storage and the Web Apps feature of Azure App Service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../../M1/02/lab02.html">
            
                <a href="../../M1/02/lab02.html">
            
                    
                    LAB 2 - Build a front-end web application by using Azure Web Apps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="../../M1/02/lab03.html">
            
                <a href="../../M1/02/lab03.html">
            
                    
                    LAB 3 - Clean up your subscription
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../../M1/03/">
            
                <a href="../../M1/03/">
            
                    
                    3. Implemente Azure functions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.1" data-path="../../M1/03/Azure_functions.html">
            
                <a href="../../M1/03/Azure_functions.html">
            
                    
                    3.1. Explore Azure Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2" data-path="../../M1/03/Develop_azure_functions.html">
            
                <a href="../../M1/03/Develop_azure_functions.html">
            
                    
                    3.2. Develop Azure Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.3" data-path="../../M1/03/Implement_functions.html">
            
                <a href="../../M1/03/Implement_functions.html">
            
                    
                    3.3. Implement Durable Functions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Hands-on Labs</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="../../M1/03/lab01.html">
            
                <a href="../../M1/03/lab01.html">
            
                    
                    LAB 1 - Create Azure resources
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="../../M1/03/lab02.html">
            
                <a href="../../M1/03/lab02.html">
            
                    
                    LAB 2 - Configure a local Azure Functions project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="../../M1/03/lab03.html">
            
                <a href="../../M1/03/lab03.html">
            
                    
                    LAB 3 - Create a function that’s triggered by an HTTP request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.4" data-path="../../M1/03/lab04.html">
            
                <a href="../../M1/03/lab04.html">
            
                    
                    LAB 4 - Create a function that triggers on a schedule
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.5" data-path="../../M1/03/lab05.html">
            
                <a href="../../M1/03/lab05.html">
            
                    
                    LAB 5 - Create a function that integrates with other services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.6" data-path="../../M1/03/lab06.html">
            
                <a href="../../M1/03/lab06.html">
            
                    
                    LAB 6 - Deploy a local function project to an Azure Functions app
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.7" data-path="../../M1/03/lab07.html">
            
                <a href="../../M1/03/lab07.html">
            
                    
                    LAB 7 - Clean up your subscription
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Develop for Azure storage</li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="../../M2/01/">
            
                <a href="../../M2/01/">
            
                    
                    4. Develop solutions that use Cosmos DB storage
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1.1" data-path="../../M2/01/Cosmosdb_overview.html">
            
                <a href="../../M2/01/Cosmosdb_overview.html">
            
                    
                    4.1. Explore Azure Cosmos DB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.2" data-path="../../M2/01/Cosmosdb_structure.html">
            
                <a href="../../M2/01/Cosmosdb_structure.html">
            
                    
                    4.2. Implement partitioning in Azure Cosmos DB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.3" data-path="../../M2/01/Working_cosmosdb.html">
            
                <a href="../../M2/01/Working_cosmosdb.html">
            
                    
                    4.3. Work with Azure Cosmos DB
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Hands-on Labs</li>
        
        
    
        <li class="chapter " data-level="9.1" data-path="../../M2/01/lab01.html">
            
                <a href="../../M2/01/lab01.html">
            
                    
                    LAB 1 - Creating data store resources in Azure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="../../M2/01/lab02.html">
            
                <a href="../../M2/01/lab02.html">
            
                    
                    LAB 2 - Review and upload data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.3" data-path="../../M2/01/lab03.html">
            
                <a href="../../M2/01/lab03.html">
            
                    
                    LAB 3 - Configure a .NET web application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.4" data-path="../../M2/01/lab04.html">
            
                <a href="../../M2/01/lab04.html">
            
                    
                    LAB 4 - Clean up your subscription
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="10.1" data-path="../../M2/02/">
            
                <a href="../../M2/02/">
            
                    
                    5. Develop solutions that use blob storage
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="10.1.1" data-path="../../M2/02/Blob_storage_concepts.html">
            
                <a href="../../M2/02/Blob_storage_concepts.html">
            
                    
                    5.1. Explore Azure Blob storage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.1.2" data-path="../../M2/02/Blob_storage_lifecycle.html">
            
                <a href="../../M2/02/Blob_storage_lifecycle.html">
            
                    
                    5.2. Manage the Azure Blob storage lifecycle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.1.3" data-path="../../M2/02/Working_blob_storage.html">
            
                <a href="../../M2/02/Working_blob_storage.html">
            
                    
                    5.3. Work with Azure Blob storage
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Hands-on Labs</li>
        
        
    
        <li class="chapter " data-level="11.1" data-path="../../M2/02/lab01.html">
            
                <a href="../../M2/02/lab01.html">
            
                    
                    LAB 1 - Create Azure resources
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.2" data-path="../../M2/02/lab02.html">
            
                <a href="../../M2/02/lab02.html">
            
                    
                    LAB 2 - Upload a blob into a container
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.3" data-path="../../M2/02/lab03.html">
            
                <a href="../../M2/02/lab03.html">
            
                    
                    LAB 3 - Access containers by using the .NET SDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.4" data-path="../../M2/02/lab04.html">
            
                <a href="../../M2/02/lab04.html">
            
                    
                    LAB 4 - Retrieve blob Uniform Resource Identifiers (URIs) by using the .NET SDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.5" data-path="../../M2/02/lab05.html">
            
                <a href="../../M2/02/lab05.html">
            
                    
                    LAB 5 - Clean up your subscription
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Implement Azure security</li>
        
        
    
        <li class="chapter " data-level="12.1" data-path="../../M3/01/">
            
                <a href="../../M3/01/">
            
                    
                    6. Implement use authentication and authorization
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="12.1.1" data-path="../../M3/01/Implement_auth.html">
            
                <a href="../../M3/01/Implement_auth.html">
            
                    
                    6.1. Explore the Microsoft identity platform
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.1.2" data-path="../../M3/01/Microsoft_id_platform.html">
            
                <a href="../../M3/01/Microsoft_id_platform.html">
            
                    
                    6.2. Implement authentication by using the Microsoft Authentication Library
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.1.3" data-path="../../M3/01/Implement_shared_access.html">
            
                <a href="../../M3/01/Implement_shared_access.html">
            
                    
                    6.3. Implement shared access signatures
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.1.4" data-path="../../M3/01/Microsoft_graph.html">
            
                <a href="../../M3/01/Microsoft_graph.html">
            
                    
                    6.4. Explore Microsoft Graph
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Hands-on Labs</li>
        
        
    
        <li class="chapter " data-level="13.1" data-path="../../M3/01/lab01.html">
            
                <a href="../../M3/01/lab01.html">
            
                    
                    LAB 1 - Configure a single-tenant Azure AD environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="13.2" data-path="../../M3/01/lab02.html">
            
                <a href="../../M3/01/lab02.html">
            
                    
                    LAB 2 - Create a single-tenant ASP.NET web app
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="13.3" data-path="../../M3/01/lab03.html">
            
                <a href="../../M3/01/lab03.html">
            
                    
                    LAB 3 - Clean up your lab environment
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="14.1" data-path="../../M3/02/">
            
                <a href="../../M3/02/">
            
                    
                    7. Implement secure cloud solutions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="14.1.1" data-path="../../M3/02/Implement_key_vault.html">
            
                <a href="../../M3/02/Implement_key_vault.html">
            
                    
                    7.1. Implement Azure Key Vault
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="14.1.2" data-path="../../M3/02/Implement_identities.html">
            
                <a href="../../M3/02/Implement_identities.html">
            
                    
                    7.2. Implement managed identities
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="14.1.3" data-path="../../M3/02/Implement_app_config.html">
            
                <a href="../../M3/02/Implement_app_config.html">
            
                    
                    7.3. Implement Azure App Configuration
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Hands-on Labs</li>
        
        
    
        <li class="chapter " data-level="15.1" data-path="../../M3/02/lab01.html">
            
                <a href="../../M3/02/lab01.html">
            
                    
                    LAB 1 - Create Azure resources
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="15.2" data-path="../../M3/02/lab02.html">
            
                <a href="../../M3/02/lab02.html">
            
                    
                    LAB 2 - Configure secrets and identities
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="15.3" data-path="../../M3/02/lab03.html">
            
                <a href="../../M3/02/lab03.html">
            
                    
                    LAB 3 - Build an Azure Functions app
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="15.4" data-path="../../M3/02/lab04.html">
            
                <a href="../../M3/02/lab04.html">
            
                    
                    LAB 4 - Access Azure Blob Storage data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="15.5" data-path="../../M3/02/lab05.html">
            
                <a href="../../M3/02/lab05.html">
            
                    
                    LAB 5 - Clean up your subscription
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Monitor, troubleshoot, and optimize Azure solutions</li>
        
        
    
        <li class="chapter " data-level="16.1" data-path="../01/">
            
                <a href="../01/">
            
                    
                    8. Integrate caching and content delivery within solutions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="16.1.1" data-path="../01/Develop_cache_redis.html">
            
                <a href="../01/Develop_cache_redis.html">
            
                    
                    8.1. Develop for Azure Cache for Redis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="16.1.2" data-path="../01/Develop_storage_cdn.html">
            
                <a href="../01/Develop_storage_cdn.html">
            
                    
                    8.2. Develop for storage on CDNs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Hands-on Labs</li>
        
        
    
        <li class="chapter " data-level="17.1" data-path="../01/lab01.html">
            
                <a href="../01/lab01.html">
            
                    
                    LAB 1 - Create Azure resources
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="17.2" data-path="../01/lab02.html">
            
                <a href="../01/lab02.html">
            
                    
                    LAB 2 - Configure Content Delivery Network and endpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="17.3" data-path="../01/lab03.html">
            
                <a href="../01/lab03.html">
            
                    
                    LAB 3 - Upload and configure static web content
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="17.4" data-path="../01/lab04.html">
            
                <a href="../01/lab04.html">
            
                    
                    LAB 4 - Use Content Delivery Network endpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="17.5" data-path="../01/lab05.html">
            
                <a href="../01/lab05.html">
            
                    
                    LAB 5 - Clean up your subscription
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="18.1" data-path="./">
            
                <a href="./">
            
                    
                    9. Instrument solutions to support monitoring and logging
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="18.1.1" data-path="Monitor_app.html">
            
                <a href="Monitor_app.html">
            
                    
                    9.1. Monitor app performance
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Hands-on Labs</li>
        
        
    
        <li class="chapter " data-level="19.1" data-path="lab01.html">
            
                <a href="lab01.html">
            
                    
                    LAB 1 - Create and configure Azure resources
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="19.2" data-path="lab02.html">
            
                <a href="lab02.html">
            
                    
                    LAB 2 - Monitor a local web API by using Application Insights
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="19.3" data-path="lab03.html">
            
                <a href="lab03.html">
            
                    
                    LAB 3 - Monitor a web API using Application Insights
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="19.4" data-path="lab04.html">
            
                <a href="lab04.html">
            
                    
                    LAB 4 - Application Insights logging with .NET
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="19.5" data-path="lab05.html">
            
                <a href="lab05.html">
            
                    
                    LAB 5 - Clean up your subscription
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Connect to and consume Azure services and third-party services</li>
        
        
    
        <li class="chapter " data-level="20.1" data-path="../../M5/01/">
            
                <a href="../../M5/01/">
            
                    
                    10. Implement API Management
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="20.1.1" data-path="../../M5/01/API_Management.html">
            
                <a href="../../M5/01/API_Management.html">
            
                    
                    10.1. Explore API Management
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Hands-on Labs</li>
        
        
    
        <li class="chapter " data-level="21.1" data-path="../../M5/01/lab01.html">
            
                <a href="../../M5/01/lab01.html">
            
                    
                    LAB 1 - Create an Azure App Service resource by using a Docker container image
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="21.2" data-path="../../M5/01/lab02.html">
            
                <a href="../../M5/01/lab02.html">
            
                    
                    LAB 2 - Build an API proxy tier by using Azure API Management
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="21.3" data-path="../../M5/01/lab03.html">
            
                <a href="../../M5/01/lab03.html">
            
                    
                    LAB 3 - Clean up your subscription
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="22.1" data-path="../../M5/02/">
            
                <a href="../../M5/02/">
            
                    
                    11. Develop event-based solutions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="22.1.1" data-path="../../M5/02/Event_grid.html">
            
                <a href="../../M5/02/Event_grid.html">
            
                    
                    11.1. Explore Azure Event Grid
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="22.1.2" data-path="../../M5/02/Event_hubs.html">
            
                <a href="../../M5/02/Event_hubs.html">
            
                    
                    11.2. Explore Azure Event Hubs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Hands-on Labs</li>
        
        
    
        <li class="chapter " data-level="23.1" data-path="../../M5/02/lab01.html">
            
                <a href="../../M5/02/lab01.html">
            
                    
                    LAB 1 - Create Azure resources
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="23.2" data-path="../../M5/02/lab02.html">
            
                <a href="../../M5/02/lab02.html">
            
                    
                    LAB 2 - Create an Event Grid subscription
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="23.3" data-path="../../M5/02/lab03.html">
            
                <a href="../../M5/02/lab03.html">
            
                    
                    LAB 3 - Publish Event Grid events from .NET
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="23.4" data-path="../../M5/02/lab04.html">
            
                <a href="../../M5/02/lab04.html">
            
                    
                    LAB 4 - Clean up your subscription
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="24.1" data-path="../../M5/03/">
            
                <a href="../../M5/03/">
            
                    
                    12. Develop message-based solutions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="24.1.1" data-path="../../M5/03/Message_queues.html">
            
                <a href="../../M5/03/Message_queues.html">
            
                    
                    12.1. Discover Azure message queues
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Hands-on Labs</li>
        
        
    
        <li class="chapter " data-level="25.1" data-path="../../M5/03/lab01.html">
            
                <a href="../../M5/03/lab01.html">
            
                    
                    LAB 1 - Create Azure resources
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="25.2" data-path="../../M5/03/lab02.html">
            
                <a href="../../M5/03/lab02.html">
            
                    
                    LAB 2 - Create a .NET Core project to publish messages to a Service Bus queue
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="25.3" data-path="../../M5/03/lab03.html">
            
                <a href="../../M5/03/lab03.html">
            
                    
                    LAB 3 - Create a .NET Core project to read messages from a Service Bus queue
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="25.4" data-path="../../M5/03/lab04.html">
            
                <a href="../../M5/03/lab04.html">
            
                    
                    LAB 4 - Clean up your subscription
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">EXTRA. Introduction to Azure Logic Apps</li>
        
        
    
        <li class="chapter " data-level="26.1" data-path="../../M6/01/azure_logic_apps.html">
            
                <a href="../../M6/01/azure_logic_apps.html">
            
                    
                    Introduction to Azure Logic Apps
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Hands-on Labs</li>
        
        
    
        <li class="chapter " data-level="27.1" data-path="../../M6/01/lab01.html">
            
                <a href="../../M6/01/lab01.html">
            
                    
                    LAB 1 - Set up the lab environment that consists of an Azure storage account and an Azure logic app
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="27.2" data-path="../../M6/01/lab02.html">
            
                <a href="../../M6/01/lab02.html">
            
                    
                    LAB 2 - Configure Azure logic app to monitor changes to a resource group
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="27.3" data-path="../../M6/01/lab03.html">
            
                <a href="../../M6/01/lab03.html">
            
                    
                    LAB 3 - Clean up your subscription
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Published with HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >LAB 4 - Application Insights logging with .NET</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="lab-4-application-insights-logging-with-net">Lab 4: Application Insights logging with .NET</h2>
<h4 id="task-1-configure-logging-for-a-net-api-app">Task 1: Configure logging for a .NET API app</h4>
<ol>
<li><p>Switch to the <strong>Visual Studio Code</strong> window.</p>
</li>
<li><p>At the terminal prompt, run the following command to set the current directory to the <strong>$HOME\training-az204\Labs\11\Starter\Api</strong>, where the deployment files reside:</p>
<pre><code>cd $HOME\training-az204\Labs\11\Starter\Api
</code></pre></li>
<li><p>Run the following command to import version 2.20.0 of <strong>Microsoft.Extensions.Logging.ApplicationInsights</strong> from NuGet to the current project:</p>
<pre><code>dotnet add package Microsoft.Extensions.Logging.ApplicationInsights --version 2.20.0
</code></pre><blockquote>
<p><strong>Note</strong>: The <strong>dotnet add package</strong> command will add the <strong>Microsoft.ApplicationInsights</strong> package from NuGet. For more information, refer to <a href="https://www.nuget.org/packages/Microsoft.Extensions.Logging.ApplicationInsights" target="_blank">Microsoft.Extensions.Logging.ApplicationInsights</a>.</p>
</blockquote>
</li>
<li><p>In the <strong>Visual Studio Code</strong> window, in the <strong>Explorer</strong> pane, navigate to the <strong>Controllers</strong> folder, and then open the file <strong>WeatherForecastController.cs</strong>.</p>
</li>
<li><p>Review the content of the file and note that it includes a constructor injection for the generic ILogger<weatherforecastcontroller> interface.</weatherforecastcontroller></p>
<pre><code class="lang-csharp"><span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc;
<span class="hljs-keyword">namespace</span> <span class="hljs-title">SimpleApi.Controllers</span>;
[<span class="hljs-meta">ApiController</span>]
[<span class="hljs-meta">Route(<span class="hljs-meta-string">&quot;[controller]&quot;</span>)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">WeatherForecastController</span> : <span class="hljs-title">ControllerBase</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">string</span>[] Summaries = <span class="hljs-keyword">new</span>[]
    {
        <span class="hljs-string">&quot;Freezing&quot;</span>, <span class="hljs-string">&quot;Bracing&quot;</span>, <span class="hljs-string">&quot;Chilly&quot;</span>, <span class="hljs-string">&quot;Cool&quot;</span>, <span class="hljs-string">&quot;Mild&quot;</span>, <span class="hljs-string">&quot;Warm&quot;</span>, <span class="hljs-string">&quot;Balmy&quot;</span>, <span class="hljs-string">&quot;Hot&quot;</span>, <span class="hljs-string">&quot;Sweltering&quot;</span>, <span class="hljs-string">&quot;Scorching&quot;</span>
    };
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ILogger&lt;WeatherForecastController&gt; _logger;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">WeatherForecastController</span>(<span class="hljs-params">ILogger&lt;WeatherForecastController&gt; logger</span>)</span>
    {
        _logger = logger;
    }
    [<span class="hljs-meta">HttpGet(Name = <span class="hljs-meta-string">&quot;GetWeatherForecast&quot;</span>)</span>]
    <span class="hljs-function"><span class="hljs-keyword">public</span> IEnumerable&lt;WeatherForecast&gt; <span class="hljs-title">Get</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">return</span> Enumerable.Range(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>).Select(index =&gt; <span class="hljs-keyword">new</span> WeatherForecast
        {
            Date = DateTime.Now.AddDays(index),
            TemperatureC = Random.Shared.Next(<span class="hljs-number">-20</span>, <span class="hljs-number">55</span>),
            Summary = Summaries[Random.Shared.Next(Summaries.Length)]
        })
        .ToArray();
    }
}
</code></pre>
<blockquote>
<p><strong>Note</strong>: You&apos;ll leverage this configuration to implement custom logging. Currently, the constructor displays a group of five randomly generated weather forecasts. You&apos;ll modify the controller to display one forecast at a time. For each forecast, you&apos;ll generate an informational, warning, or error log entry indicating the type of weather (mild, severe, and extreme). After these log entries are recorded by Application Insights in the corresponding Log Analytics workspace, each entry will have an automatically assigned severity level of 1, 2, or 3. </p>
</blockquote>
</li>
<li><p>Replace the definition of the <code>public IEnumerable&lt;WeatherForecast&gt; Get()</code> method in the file <strong>WeatherForecastController.cs</strong> with the following content:</p>
<pre><code class="lang-csharp">    {
        <span class="hljs-keyword">var</span> rng = <span class="hljs-keyword">new</span> Random();            
        <span class="hljs-built_in">int</span> temperatureC = rng.Next(<span class="hljs-number">-20</span>, <span class="hljs-number">55</span>);
        <span class="hljs-keyword">var</span> summaryId = rng.Next(Summaries.Length);
        <span class="hljs-keyword">switch</span> (summaryId)
        {
            <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>: <span class="hljs-keyword">case</span> <span class="hljs-number">9</span>:
            _logger.LogError(<span class="hljs-string">&quot;WeatherForecast: extreme weather&quot;</span>);
            <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>: <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>:
            _logger.LogWarning(<span class="hljs-string">&quot;WeatherForecast: severe weather&quot;</span>);
            <span class="hljs-keyword">break</span>;
            <span class="hljs-literal">default</span>:
            _logger.LogInformation(<span class="hljs-string">&quot;WeatherForecast: mild weather&quot;</span>);
            <span class="hljs-keyword">break</span>;
        }
        <span class="hljs-keyword">return</span> Enumerable.Range(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>).Select(index =&gt; <span class="hljs-keyword">new</span> WeatherForecast
        {
            Date = DateTime.Now.AddDays(index),
            TemperatureC = temperatureC,
            Summary = Summaries[summaryId]
        })
        .ToArray();
    }
</code></pre>
</li>
<li><p>Save and close the file.</p>
</li>
<li><p>At the terminal prompt, run the following command to build the .NET Web API:</p>
<pre><code>dotnet build
</code></pre></li>
</ol>
<h4 id="task-2-test-logging-of-a-net-core-api-app">Task 2: Test logging of a .NET Core API app</h4>
<ol>
<li><p>Run the following command to launch the .NET Web API.</p>
<pre><code>dotnet run
</code></pre><blockquote>
<p><strong>Note</strong>: Keep the web API running and monitor the output of the Visual Studio Code <strong>terminal</strong> pane as you perform the next steps in this task.</p>
</blockquote>
</li>
<li><p>Review the output of the command and note the HTTPS URL that the site is listening on.</p>
</li>
<li><p>From the taskbar, open the context menu for the <strong>Microsoft Edge</strong> icon, and then open a new browser window.</p>
<blockquote>
<p><strong>Note</strong>: Position the browser window such that it doesn&apos;t block the Visual Studio Code <strong>terminal</strong> pane.</p>
</blockquote>
</li>
<li><p>In the browser window that opens, navigate to the URL you identified and add the <strong>/weatherforecast</strong> relative path of your web API  and then refresh the page several times.</p>
<blockquote>
<p><strong>Note</strong>: The full URL is <code>http://localhost:[port-number]/weatherforecast</code>, where the <code>[port-number]</code> placeholder identifies the port number at which the web app is accessible via the HTTPS protocol.</p>
<p><strong>Note</strong>: Each time you refresh the page, it should display a different weather forecast in the following format.</p>
</blockquote>
<pre><code>[{&quot;date&quot;:&quot;2021-09-04T14:35:29.0789168-07:00&quot;,&quot;temperatureC&quot;:2,&quot;temperatureF&quot;:35,&quot;summary&quot;:&quot;Sweltering&quot;}]
</code></pre><blockquote>
<p><strong>Note</strong>: Each refresh of the page should result in an informational, warning, or error message display at the terminal prompt, in the following format:</p>
</blockquote>
<pre><code>warn: SimpleApi.Controllers.WeatherForecastController[0]
  WeatherForecast: severe weather
</code></pre><blockquote>
<p><strong>Note</strong>: Refresh the page several times to ensure that you generated at least one message of each type (<strong>info</strong>, <strong>warn</strong>, and <strong>fail</strong>).</p>
</blockquote>
</li>
<li><p>Leave the API app running.</p>
</li>
</ol>
<h4 id="task-3-review-the-application-insights-logging">Task 3: Review the Application Insights logging</h4>
<ol>
<li><p>On your lab computer, switch to the <strong>Microsoft Edge</strong> browser window displaying the Azure portal.</p>
</li>
<li><p>In the Azure portal, navigate back to the blade of the <strong>instrm</strong><em>[yourname]</em> Application Insights resource you created previously in this lab.</p>
</li>
<li><p>On the <strong>Application Insights</strong> blade, in the <strong>Monitoring</strong> section, select <strong>Logs</strong>.</p>
</li>
<li><p>If needed, close the <strong>Welcome to Log Analytics</strong> pane and <strong>Queries</strong> pane.</p>
</li>
<li><p>In the <strong>New Query</strong> pane, type the following query and select <strong>Run</strong>:</p>
<pre><code>traces
| order by timestamp desc
</code></pre></li>
<li><p>Review the results of the query.</p>
<blockquote>
<p><strong>Note</strong>: The results should include log entries corresponding to the warning and error messages generated by the .NET Core api app, with their respective severity levels (2 and 3).</p>
<p><strong>Note</strong>: It can take up to five minutes to observe requests in the Application Insights metrics charts.</p>
</blockquote>
<p>The following screenshot displays the log query results on the <strong>Application Insights Logs</strong> blade.</p>
<p>   <img src="images/l11_web_api_insights_logs.png" alt="Log query results on the Application Insights Logs blade"></p>
<blockquote>
<p><strong>Note</strong>: You could deploy the updated API app to an Azure web app to collect its logs using Application Insights in an equivalent manner.</p>
<p><strong>Note</strong>: You can extend the Application Insights logging level to include informational events by modifying the <strong>appsettings.Development.json</strong> (or <strong>appsettings.json</strong>) file as illustrated in the following code listing. However, you should keep in mind that this will considerably increase the log volume, which has potential network performance and pricing implications:</p>
</blockquote>
<pre><code>{
  &quot;Logging&quot;: {
    &quot;LogLevel&quot;: {
      &quot;Default&quot;: &quot;Information&quot;,
      &quot;Microsoft&quot;: &quot;Warning&quot;,
      &quot;Microsoft.Hosting.Lifetime&quot;: &quot;Information&quot;
    },
    &quot;ApplicationInsights&quot;: {
      &quot;LogLevel&quot;: {
        &quot;Microsoft&quot;: &quot;Information&quot;
      }
    }
  }
}
</code></pre></li>
<li><p>Close the browser window displaying the output of your API app.</p>
</li>
<li><p>Switch to the <strong>Visual Studio Code</strong> window, and then select <strong>Kill Terminal</strong> (the <strong>Recycle Bin</strong> icon) to close the <strong>terminal</strong> pane and any associated processes.</p>
</li>
</ol>
<h2 id="review">Review</h2>
<p>In this exercise, you configured and tested Application Insights logging of your web API app.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="lab03.html" class="navigation navigation-prev " aria-label="Previous page: LAB 3 - Monitor a web API using Application Insights">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="lab05.html" class="navigation navigation-next " aria-label="Next page: LAB 5 - Clean up your subscription">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"LAB 4 - Application Insights logging with .NET","level":"19.4","depth":1,"next":{"title":"LAB 5 - Clean up your subscription","level":"19.5","depth":1,"path":"M4/02/lab05.md","ref":"M4/02/lab05.md","articles":[]},"previous":{"title":"LAB 3 - Monitor a web API using Application Insights","level":"19.3","depth":1,"path":"M4/02/lab03.md","ref":"M4/02/lab03.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"M4/02/lab04.md","mtime":"2023-01-08T00:21:19.882Z","type":"markdown"},"gitbook":{"version":"4.0.4","time":"2023-01-12T16:38:32.367Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

